### 来自网络面经

#### Redis为什么设计成了单线程的？

核心原因：
1. 对于RedisCPU不是性能瓶颈，内存和网络才是。因为Redis主要操作都是在内存中完成的，且大多数命令复杂度均为O(1)或O(logN)，即便是单线程也能轻松处理每秒几十万到百万的请求。
2. 避免对线程带来的开销与复杂性。多线程需要加锁、同步和处理竞争条件，这回引入复杂性和性能损耗。单线程避免了上下文切换、锁竞争、死锁等问题，保证执行逻辑更简单和高效。
3. 数据操作的天然有序性和原子性。单线程可以确保每个命令按顺序执行，不存在并发对资源的访问，具备了天然的原子性，不许额外的锁机制。
4. 可以高效处理大量连接，Redis使用epoll或其他I/O多路复用机制构建事件循环，单线程下处理多并发连接仍十分有效，不会在I/O处理上浪费时间。
5. 代码可维护性强，问题排查简单，因为没有线程间共享状态和复杂的同步逻辑，代码更清晰，调试更容易。
6. 便于水平扩展：Redis 更倾向于通过部署多个实例（分片、主从复制等方式）利用多核，而不是使单实例多线程化。这种方式更简单、更符合 Redis 的分布式设计思路。

而在Redis6.0时引入了多线程优化I/O，仅用于网络I/O，而命令处理仍保持单线程，这样可以使用多核提升了I/O吞吐，又不破坏命令的原子性和顺序执行的简洁性。

Redis的IO多路复用
为了让单线程的服务端应用能同时处理多个客户端事件，Redis采用了IO多路复用机制，这里的多路指的是多个网络连接客户端，复用指的是复用同一个线程，IO多路复用使用一个线程来检查多个Socket的就绪状态，在单个线程中通过记录跟踪每一个socket的状态来管理处理多个I/O流。

具体实现方式为：
- 每个socket网络连接都对应一个fd
- Redis使用I/O多路复用程序将客户端的socket对应的fd注册到监听列表中
- 当客户按执行read,write等操作命令时，I/O多路复用程序会将命令封装成一个事件，并绑定到FD上
- 文件事件处理器使用I/O多路复用模块同时监控多个fd的读写情况，当accept，read，write，close文件事件产生时，文件实际处理器会回调fd绑定的事件处理器进行处理相关命令操作。