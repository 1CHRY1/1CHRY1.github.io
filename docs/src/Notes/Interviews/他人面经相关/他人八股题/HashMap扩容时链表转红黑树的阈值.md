### 来自拼多多提前批一面面经

#### HashMap扩容时链表转红黑树的阈值为什么是8？退化为6的原因？

HashMap 为了解决 单个桶中元素过多导致查找效率退化为 O(n) 的问题，引入了链表转红黑树的机制，这样当哈希桶中链表长度太长时会转为红黑树而提升查询效率到O(logn)，但树节点所占空间是普通节点的2倍，因此在节点较少的时候需要退化成链表。

当超过8个节点时，链表查找速度O(n)退化明显，转换为红黑树可以提升为O(logn)

在理想情况下（哈希分布均匀），桶中的节点数概率(链表长度)符合泊松分布，当桶中节点数(链表长度)为 8 的时候，概率小于千分之一。这种设计更多是为了防止用户自己实现了不好的哈希算法导致链表过长而查询效率低，是一种保底策略。

将退化阈值设为6，一方面为了防止红黑树和链表之间的频繁转换，消耗大量的时间和资源，使用6将7-8作为一个滞回区间；另一方面，当桶中元素减少到 6 个以下时，链表的遍历性能已经足够好，没必要继续用红黑树这种高内存开销的结构。