### 来自拼多多提前批一面

#### TCC事务的Confirm阶段失败怎么办？

TCC模式指的是Try-Confirm-Cancel模式，其中：
Try 阶段用来预留资源、完成业务校验；
Confirm 阶段真正执行业务操作、提交事务；
Cancel 阶段则撤销 Try 预留的资源，恢复状态。
如果 Confirm 阶段失败（如网络波动、服务宕机等），往往会造成资源处于“已预留但未提交”的悬挂状态，需要采取补偿措施以确保数据一致性。

可以有以下处理策略：
1. 自动重试Confirm操作，Confirm操作必须幂等。
2. 若重试多次仍失败，则 触发 Cancel 补偿机制，撤销try预留的资源恢复系统状态，Cancel操作需要幂等。
3. 记录事务日志+定期扫描+调度补偿，将事务ID状态重试次数等计入日志，由事务协调器或后台定期扫描悬挂事务并依次补偿。
4. 人工介入
5. 保证Confirm和Cancel的幂等性

