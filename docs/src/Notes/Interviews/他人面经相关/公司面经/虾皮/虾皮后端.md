1. 自我介绍
2. HashMap 底层原理，为什么用红黑树
JDK1.7前是数组+链表，1.8后是数组+链表+红黑树
存储过程为：
先根据key.hashCode()经过扰动函数计算数组下标，若是空的就直接放入，若不是空的就比较key是否相等，若相等则覆盖，不相等则将数据挂在链表尾部。当链表长度超过8且数组长度大于64时链表会转化为红黑树优化查询性能。
HashMap在扩容时会创建一个新数组，容量为原来的两倍，重新计算元素在新数组中的位置后将原数组中的元素迁移到新数组中，会根据上述计算得到新的索引位置并迁移数据。

3. 数据库三大范式
字段不可再分（原子值）
消除部分依赖（非主键字段完全依赖于主键而并非只依赖一部分）
消除传递依赖（字段不能依赖于另一个非主键字段）

4. ACID 的实现
A —— 事务，Undolog（修改前的数据）
C —— 原子性隔离性持久性共同保证，数据库状态的转移和保证
I —— 隔离性，MVCC多版本并发控制
D —— Redolog，事务提交前会把修改后的数据写入RedoLog

5. CAP
C一致性（分布式环境下，所有节点在同一时刻看到的数据是否一致），A可用性（系统在任何时刻都能保证正常响应请求，即使部分节点宕机用户请求依然能被正确处理），P分区容错（系统遇到网络分区时，仍然能继续提供服务）
一旦出现P，就要在C和A做权衡
我开发的系统中，
卫星中心平台是CP系统，优先保证数据的一致性可靠性，因为影像数据需要保证一致性
崩岸是标准的AP系统，优先保证系统的可用性，部分监测数据会做延迟同步等。
地理信息RPC框架同样是CP系统，需要保证数据的强一致性

6. 微服务（单体服务的问题是什么）
代码复杂度高
部署/扩展困难
技术栈受限
可靠性差
交付效率低
运维压力大

7. 短链系统（不要用哈希）
短链系统：输入长URL——生成唯一短链（正常方案为输入URL后，通过Hash转换+截取后生成短链）

方案一：自增ID+进制转换（记录入库后根据自增ID转换62进制生成短链）
方案二：雪花算法生成唯一ID，同样做62进制编码得到短链
方案三：随机生成N位的锻炼字符串，插入数据库时检查是否已存在

8. 定时任务服务（开放题，实时性、可靠性怎么保证）

首先讲述定时任务调度的底层逻辑：优先队列+线程池，或时间轮
其中时间轮实现的方案是：环形数组，每个数组元素是一个时间槽代表一个固定的时间单位，指针移动时会触发当前时间槽内所有任务的执行（或交给线程池）

单机场景：使用Quartz等定时任务框架实现，通过内存的时间轮/优先队列管理任务，时间到期触发执行

分布式场景：任务存放在数据库中，由一个调度节点负责扫描和触发，基于时间轮/优先队列+线程池实现调度，每一个节点调度同一批任务，将任务多时按分片分配给不同节点执行。

业界方案：
Qartz（单机调度），XXL_Job分布式平台，Elastic-Job基于ZooKeeper的分布式调度，Kafka等消息队列存储延时任务，消费者到期消费。

定时任务服务要解决的核心问题是实时性和可靠性。
实时性方面，我会用时间轮/DelayQueue/优先队列实现毫秒级调度，避免全量扫描；可靠性方面，任务会持久化存储，并结合 分布式锁/Leader 选举 确保不会重复执行或丢失。
同时，任务执行要有重试机制、幂等性设计、日志与报警。
在分布式场景下，可以借助 XXL-Job 或 Elastic-Job 这样的框架来保证高可用和扩展性。

1.  合并有序列表
2.  合并 2 个有序列表W
3.  合并 N 个有序列表（我用的分治解题，然后面试官就没让我基于分治解 Top K 了）
4.  合并 N 个有序列表，且保留 Top K
5.  交替反转链表
6.  快慢指针判断环

---

1. 一台程序有运行瓶颈，如何找到？
CPU 瓶颈：用 top 看哪个进程占用高，再用 perf、async-profiler 或 jstack 分析热点方法。

内存瓶颈：用 jmap -dump 导出堆，借助 MAT/VisualVM 分析对象分布，判断是否有内存泄漏。

GC 瓶颈：用 jstat -gcutil 或 GC 日志，观察 Minor/Full GC 次数、耗时。

线程瓶颈：jstack 抓线程快照，查看是否有死锁、长时间等待、锁竞争。

I/O 瓶颈：用 iostat、iotop 看磁盘；netstat、iftop 看网络。

数据库瓶颈：开启慢 SQL 日志，用 explain 看执行计划；关注连接池情况。

2. 如果不知道代码，怎么找到瓶颈？
监控指标法：CPU、内存、I/O、网络、GC、线程状态。
日志分析法：看响应时间、慢请求日志。
调用链追踪：APM 工具（SkyWalking、Pinpoint、Zipkin）可显示耗时方法。
假设法：根据业务特征和系统压力点定位热点模块。

3. 用什么命令看CPU利用率、内存占用率，看完下一步怎么做？
top -> 查看高占用进程和线程 cpu
free -m -> 查看进程占用 内存
cpu高 -> jstack分析热点方法
内存高 -> jmap+mat分析对象分布
I/O高 -> iostat/iotop分析磁盘瓶颈

4. 一个函数在什么情况下会出现线程安全问题？怎么解决线程安全问题？
多个线程同时访问呢共享资源，并且至少有一个是写操作

5. 在Linux下，读一个文件，经socket上传到网络，过程中经历了几次拷贝？
用户态read() -> 内核态缓冲区 -> 网卡 -> 网络

6. 有用过redis吗？了解过zset吗？Zest的底层数据结构是什么？
集合中每个元素关联一个score分数，元素按分数排序。
ziplist（压缩列表）：数据量小（元素个数 <128 且成员长度 <64 字节）时使用，内存紧凑，但插入查找效率不高。
skiplist（跳表） + dict（哈希表）：大规模数据时使用。
dict：O(1) 查找元素是否存在、score。
skiplist：按 score 有序，支持范围查询、排序。

7. Zset用在什么场景？
排行榜：游戏用户分数排行榜，按 score 排序。
延时队列：用 score 存储时间戳，按时间有序取任务。
消息优先级队列：score 代表优先级。
限流/活跃用户统计：score 代表时间，
推荐系统：比如根据权重排序商品/内容。

8. Zset里有O(1)的命令吗？
有，但有限
O(1)：
ZCARD → 获取集合大小
ZCOUNT（在索引较小时也接近 O(1)）
ZSCORE → 获取某个成员的分数（通过 dict 实现）

9. kafka用过吗？MQ有什么缺陷？
高吞吐、分布式、顺序写、持久化、分区副本机制保证高可用。
MQ 的缺陷（通用消息队列缺点）：
- 系统复杂度增加：引入 MQ 后，系统架构复杂度变高，要处理消息幂等、顺序、积压。
- 数据一致性问题：消息发送成功但消费失败，可能导致业务不一致。
- 可用性问题：MQ 本身可能成为系统瓶颈或单点。
- 延迟问题：引入 MQ 可能带来端到端延迟，不适合强实时场景。

10. 登录场景下会有什么漏洞问题？
暴力破解
SQL注入
XSS/CSRF 攻击：跨站脚本、跨站请求伪造。
会话劫持：Cookie 被窃取。
弱密码问题：用户设置过于简单的密码。
未加密传输：明文密码在网络中传输。

11. 你会如何设计一个安全的登录功能？
传输安全（HTTPS）
加盐哈希算法
认证流程使用sessionID或签发短期有效的JWT
登陆失败N次锁定
服务端防CSRF/XSS，使用CSRF Token校验
补充安全措施

12. HTTPS协议是基于什么协议实现的？
HTTP + TLS/SSL
HTTP over TLS，底层依然是TCP

13. HTTPS的整个传输过程？
TCP 三次握手 建立连接。
TLS 握手
- 客户端发送：支持的加密套件、随机数。
- 服务器返回：证书（包含公钥）、随机数、加密算法。
- 客户端验证证书（CA 签名、有效期、域名）。
- 客户端生成会话密钥，用服务器公钥加密传给服务器。
- 双方确认会话密钥，之后使用对称加密。

14. HTTPS的数据在什么情况下会被篡改？
证书不可信：客户端接受了伪造的证书（用户忽略了浏览器警告）。
中间人攻击（MITM）：攻击者伪装成中间代理，若证书校验被绕过。
客户端被攻破：浏览器或操作系统中毒，恶意软件篡改数据。
服务端被攻破：即使 HTTPS 传输安全，但服务器被攻陷也会泄露数据。

15. 有10亿个没有重复的数字，随机等分为10份
Hash 取模法：对每个数执行 num % 10，直接写入对应的 10 个文件 → 等分。
MapReduce/大数据框架：用 Hadoop/Spark 按 key 分区。
外部排序：如果要保证每份有序，可先分区，再分别排序。

16. 假设一个订单表 order（mysql，innodb 引擎）里面有用户 ID，订单时间，现在有三种查询需求：a. 某个用户的所有订单；b. 某一天的所有订单；c. 某个用户在某天的所有订单。请填写一条SQL查询语句，计算表（Time_user_price），统计每周从周一到周六每天的累计销售额。具体要求如下：统计周期为每周，截止到周六。- 输出内容为周一至周六每天的累计销售额；- 周二：显示当天的销售额；- 周三：显示周一和周二的销售额之和；- 周四：显示周一、周二、周三的累计销售额；- 以此类推，直到周六显示本周的总销售额。

17. leetcode原题：单词最小编辑次数

---

1. 手撕：删除链表重复元素，手写LRU
2. 四次挥手
客户端 → 服务端：FIN，客户端请求断开。
服务端 → 客户端：ACK，确认收到 FIN。
服务端 → 客户端：FIN，服务端关闭连接。
客户端 → 服务端：ACK，确认关闭，进入 TIME_WAIT。

3. 多个客服端没有收到服务端的第三次挥手确认，可能是因为什么原因
网络丢包，客户端阻塞/忙碌，防火墙拦截，服务端异常退出未正常发送FIN

4. MySQL有哪些索引，索引什么时候会失效
主键索引，联合索引，空间索引，全文索引，普通索引，唯一索引等等

5. 缓存雪崩、缓存击穿、缓存穿透
雪崩：大量缓存同一时间失效 → DB 压力大。
解决：随机过期时间、缓存预热、限流。

击穿：热点 key 失效，大量请求打到 DB。
解决：加互斥锁、逻辑永不过期。

穿透：请求不存在的数据，缓存和 DB 都 miss。
解决：缓存空对象、布隆过滤器。

6. 数据库4大特性，4个隔离级别
ACID四大特性，RRRS四大隔离级别

7. 脏读不可重复读幻读，举例说明
脏读：事务 A 读到事务 B 未提交的数据。
不可重复读：事务 A 两次读同一行，值被事务 B 修改过。
幻读：事务 A 按条件查询多行，事务 B 插入新行，事务 A 再次查询时多了“幻影行”。

8. 项目里做的工作以及挑战
。。。

9. 在事务里可以使用不同的数据库实例吗，分布式事务里可以吗，可以的话是怎么做的呢（Seata）？分布式事务中调用第三方服务会导致事务失效吗？

单机事务：MySQL InnoDB → 只能在单库内保证事务。
不同数据库实例：需要分布式事务（XA、2PC、TCC）。
Seata：通过全局事务管理器（TC）、事务协调器（TM）、资源管理器（RM）实现。
调用第三方服务：第三方不支持事务，无法纳入一致性 → 需要 补偿机制（消息队列、TCC 补偿）。

10. 分布式锁是怎么实现的？要注意什么
Redis：SET key value NX PX expire（原子操作）。
ZooKeeper：临时顺序节点 + Watch。
Etcd：租约 + CAS。

11. 死锁，如果设置锁过期时间能不能解决死锁
可以部分缓解但不能完全解决。
任务执行时间>过期时间，提前释放会造成数据不一致
应该设置过期时间+续期时间，可以使用Redisson看门狗来进行锁续期

12. 共享锁和排它锁
共享锁（S 锁）：允许多个事务同时读，不能写。
排它锁（X 锁）：只能一个事务持有，禁止其他读写。

13. Redis的RDB和AOF
RDB（快照持久化）：
定时生成内存快照（dump.rdb）。
适合备份、恢复快，丢失数据量较大。
AOF（追加文件）：
记录每条写命令（appendonly.aof）。
更安全，丢失数据少，但文件大，恢复慢。

---

1. redission分布式锁怎么实现 底层原理是什么
基于 Redis 的 SET key value NX PX expireTime 命令实现互斥锁（保证原子性）。
Redisson 会生成唯一标识（UUID + 线程 ID）作为 value，确保锁能区分不同客户端。
看门狗机制：默认 30s 自动续期（如果业务执行未完成，后台任务会不断延长锁的过期时间）。

2. 设置超时时间超过了怎么处理
超过了固定时间锁会自动释放，因此需要保证业务逻辑小于。。

3. setnx和redission分布式锁实现区别
setnx分两步操作不原子，redisson为原子操作

4. 定时任务 xxljob


执行任务时间过长 超过执行周期怎么办 怎么应对
怎么避免这个问题
开始计算机网络 拷打爆了
IO多路复用几种方式
虚拟内存是什么
为什么要有虚拟内存
TCP拥塞控制和流量控制有什么区别
避免拥塞算法怎么实现
mysql为什么有深分页 什么是深分页 怎么解决
mysql事务 隔离级别怎么实现
算法
topk 小顶堆
有一亿个整数找最大100个 怎么实现
LRU怎么实现
手撕二维数组找目标值 很普通的遍历..

---

1、自我介绍

2、手撕：二叉树的最大深度，自定义输入输出

3、MySQL事务隔离级别，什么是幻读

4、MySQL索引如何实现

5、什么是回表

6、你建索引会考虑什么因素

7、开放问题：有一个订单表，已经存了几千万数据了，性能不好，你会怎么做，去优化他的读写性能

8、你觉得用时间分表，是一个好的分表策略吗

9、你怎么想到用hash的方式做id分表

10、即时通信项目中，如何保证消息顺序的一致性呢，特别是在群聊中，分布式的情况下，怎么保证你的每条数据时间戳都是一致的呢（面试官想听分布式时钟，可惜我没看过）（让我考虑一下im项目中的数据有序性，说这个比较重要）

---

