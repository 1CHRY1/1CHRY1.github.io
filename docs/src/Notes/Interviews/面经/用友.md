## 用友一面

和善面试官，疯狂点赞

1. 自我介绍，介绍到最后一个RPC框架时打断，问到你的RPC框架和市面上其他的差不多（其他的也能实现你的功能），你为啥要自己造一个轮子。

当时回答：
- 需要将地理资源靠近模型侧从而减少数据传输降低效率
- 在此基础上还有一个数据管理器，需要一个契合上层建筑的架构
---
现在的想法：地理资源RPC框架需要实现资源/服务之间的相互依赖，是一种有状态的RPC框架而并非传统RPC框架

借鉴橙子各的观点：
总的来说，我认为RPC本质上是一种服务构建的风格，我们搭建的框架是在这个风格基础上添加了地理信息的特色，也就是资源的适配能力。
- 正常我们使用的RPC框架不用考虑到数据状态，这种一般都由数据库帮我们实现了，但因为地理信息资源是多态的难维护的，我们在使用地理信息资源的时候也将资源作为服务，成为能够在框架中通信的单元。那么为了让资源也能够实现通信能力，我们构建了这个RPC框架
- 我们不用市面上比较成熟的RPC框架，也是因为把资源通信的模块放入了我们的框架，这样就不需要在不同项目中实现资源通信的业务了，便于管理
- 在资源通信之外，我们在上层也简单实现一个资源管理框架，目前只是用Redisson实现了资源的读写锁，就是读写互斥，写写互斥，读读不互斥的那一套，后续也希望加入针对不同资源的配套版本管理模块、依赖资源间的锁继承/判断问题

2. 为什么选用Vertx做服务器，优势在哪里

当时回答：基于Netty开发，有着异步非阻塞IO特性，与RPC框架相契合
---
后面总结：
- 异步非阻塞，将请求处理交给事件循环线程池，每个请求不会占用额外的线程。
- 继承了Netty高效的底层通信能力，并进一步封装，提供了现成的插件。
- 跨语言特性，不同语言编写的Verticle可以通过事件总线无缝通信
- 轻量化引入，提供核心功能，插件可额外引入

3. 大文件上传的流程是什么？你的大文件在文件上传完成后如何合并的？

当时回答：
- 先检测后端服务带宽，在前端生成大文件md5码后文件分片，并发起请求开始上传，后端此时在Redis中插入一个数据条目。将文件分片上传，在Redis中记录进度，全部上传完毕后发起请求实现合并。
- 文件合并可以通过buffer+流式合并

---

Minio提供了一种multipart Upload协议，只要按照协议把每个分片（Part）上传到 MinIO 指定的预签名 URL，最后 再发一次 CompleteMultipartUpload 请求 即可由 MinIO 在服务端完成合并——这个合并是 MinIO 内部做的，不需要我们再手动读写流。

流式合并的核心原理是：
使用一小部分的内存buffer，一边打开目标文件并读取数据，得到一段bytes后，将数据落盘。

1. 用户鉴权，session，cookie的关系，用户未登录的时候session怎么存，多次登陆失败自己跳出验证码的逻辑

当时回答：session存在服务器中，将sessionId编码后存在cookie中，放在请求头中传到服务器。session可以通过Spring中的配置存在Redis中实现复用。用户未登陆时会生成临时session，记录用户的ip，端口以及请求的网页，并记录登陆次数。若用户登陆失败超过一定次数，则自动跳出验证码逻辑
---
用户未登录时应该不建session，只在Redis中用ip+ua维度原子累加失败次数，≥5 次就让登录接口返回 needCaptcha=true，前端收到即弹验证码。

5. Redis可以用来做分布式锁，看门狗机制，如果用Java去实现你会怎么做呢？

当时回答：Redissian的看门狗机制可以实现分布式锁的定期续约。Redissian中实现是“先检查字段是否存在锁，获取锁的值，修改值”
如果用Java实现，可以使用Quartz定时任务作为分布式锁续约的工具。面试官：Quartz太重了不合适，可以用一个线程实现。
---
获取锁成功后，启动一条 daemon 守护线程（while+sleep），每隔 锁 TTL/3 秒执行一次 PEXPIRE lockKey newTTL，业务线程释放锁时通过 中断信号 结束守护线程，简单轻量，无第三方依赖。

6. 问使用过线程池吗？回答是后追问，父线程如何与子线程实现通信（记不清了）？回答用ThreadLocal可以实现线程内部变量的存储后打断说希望用Java原生的方法，回答不会后，又追问线程池线程操作失败，主线程是如何发现的？

---
通信靠任务对象本身：把结果或异常封进 Future，主线程 future.get() 即可阻塞拿到结果/异常；额外通信可用
CountDownLatch（让 1 个或多个 “等待线程” 阻塞，直到其他 “任务线程” 完成指定数量的操作后，才唤醒所有等待线程继续执行）
CyclicBarrier（让多个线程 “互相等待”，直到所有线程都到达某个 “屏障点” 后，才一起继续执行后续逻辑；）
CompletableFuture（任务结果的链式处理+多任务组合协调） 等原生同步器。

失败感知：线程池会把运行时异常封装进Future，future.get() 会抛出 ExecutionException，主线程捕获即知失败；
若提交的是 Runnable 且不拿 Future，则线程池会调用 Thread.UncaughtExceptionHandler 输出异常，但主线程无法直接感知，因此必须拿 Future 或重写 afterExecute。

7. Spring的事务传播机制，newRequest是怎么做的

当时回答：Spring事务传播主要是用作Spring事务的嵌套关系，newRequest是每次都新开启一个事务
---
Spring 事务传播行为 PROPAGATION_REQUIRES_NEW会把当前事务挂起（suspend），重新开启一个完全独立的新事务，提交/回滚只影响自己，原事务继续走自己的上下文。

挂起动作由 TransactionManager 完成：把当前连接从 ThreadLocal 拿掉，保存状态 → 新事务拿到新连接 → 结束后恢复旧连接。
两个事务完全隔离：内事务回滚不会导致外事务回滚；外事务已提交的数据对内事务可见（取决于隔离级别）。
使用场景：异步落日志、写操作日志表、多数据源批量处理等必须独立提交的场景。

8. mysql索引的实现
```sql
# (A,B,C)是联合索引
where A = 1
where B = 2
where C = 1 and A = 2
# 哪个用到了联合索引

```
第一个用到了联合索引，第三个也用到了联合索引（第三个看似乱序但MySQL优化器会自动改写为先A再C）
---
如果换成Hash索引呢
Hash索引仅做一次哈希计算+定位行指针，不支持组合键的联合哈希，更不支持排序。因此是失效的，只能做全表扫描

------

9. 你听过用友吗？知道是做什么的吗？
回答做管理软件

10. 三年后会选择开发还是测试还是运维

11. 单元测试和开发的时间比例

12.  有没有采取什么措施提高测试效率

反问：
面试流程：后面应该还会有三轮面试
部门业务
对我的评价

## 用友二面

1. 自我介绍

2. 牛客手撕版本大小对比（用"."分割的字符串，每个字串都是一个版本号）

**当时实现：**获取每个字符串被"."分隔的子串数组并获取其长度，for遍历每个字符串数组直到其中一个用完，若出现不同的字符串则return版本大小顺序徐
若未返回，则判断哪个字符数组还有剩余值，若剩余值出现非0值则return版本大小顺序（两个for循环）

面试官指出需要空间复杂度O(1)后，回答可以用两个游标记录当前版本而不用split
又问如果使用α，β代替11，12如何实现版本对比，回答使用Map存储数字映射，追问代码逻辑，再回答可以将所有用到的1-16等全部放入Map中统一实现代码逻辑

（最后被吐槽写慢了，代码结构也不够优雅，不过面试官似乎不看重这个，说这是短期刷题带来的）
此时已经用了25min
---

3. 讲述了解最深的一个项目 —— 卫星项目

从数据结构讲起，用mysql存储影像元数据，用minio存储原始数据，用redis缓存查询数据，详细讲了cog和全球划分网格的使用（中间被打断说讲的逻辑不够好，从业务角度去描述项目而不是上来就从底层讲）
基于网格数据结构，又讲了ray框架实现影像数据的分布式计算，减少资源消耗等
最后讲了可视化服务，使用mapbox的瓦片渲染方案，还有基于可视化服务改写生成多波段合成的png数据，减少传输的数据量
（中间被打断询问其中内容但没有质疑，整体体验还不错）

问项目中认为项目中比较困难的点在哪？
当时脑子空白了，说了困难点主要在于数据量大，又说到minio集群存储的问题（这块说的不清楚，还有minio基于硬件的存储方案等，包括文件服务器等，后续还要再了解）。后又说道自己部署了k8s集群，并在ray分布式计算框架和可视化服务中使用，本来用的是nginx手动实现了负载均衡器。

最后问到对于这个项目还有什么优化点
卡壳了，当时没想到，后续要准备一下；
当时说之前没讲到的docker in docker方案的问题，后浅浅说了jupyter的core和解释器调度的方案，但时间到了一小时十分左右，后被打断

4. 问为什么不去专业更对口的公司，比如超图，高德等
当时回答：自己并不想在地信行业中，因为行业发展并不好

5. 问tob和toc的区别
说的比较笼统

6. 问对用友的了解，说了做管理软件和tob业务后，介绍了一下他们是做税务相关的tob业务，和toc相比toc业务更加复杂需要很多协调沟通能力等等，普及了一下知识

7. 最后说到自己未来的定位，说希望在业务技术了解透彻后希望走向管理岗，因为喜欢带领团队工作，解决困难等问题。

反问：
后面的面试流程是什么？
对我面试表现的评价

总体上来看，还需要补齐的有：minio的存储方案原理、jupyter的架构和在线编程实现方案、简历中每个项目的困难点闪光点和其他的优化方案

## HR面

网上看到的：
---
- 自我介绍（南师大，应届硕士，南京人，在南京呆久了愿意换到大城市工作）
- 工作地点（北京）
- 用三个词语形容下自己的优点（（行动力）喜欢探索各类技术并付诸实践，行动能力比较强，（越挫越勇）不怕困难反而在遇到困难的时候会燃起斗志，（责任心）对工作比较有责任心也有带领团队开发的经验，（随和）性格比较好喜欢交流也愿意在工作中帮助同学/同事）
- 用三个词语形容下自己的缺点（（性急）碰到想做的
- 事情会比较急着想解决，比如我买个比较想要的东西都会隔一会就看它的状态，（自我）有时候说话不太注意可能让别人听的不太舒服，（惰性）在不喜欢的工作面前可能会偷懒不想干等等）
- 了解用友吗：在前两个技术面试官那简单了解了用友的业务，税务相关的tob业务，构建数智商业创新平台，服务千万家企业的数智业务，云服务和软件提供商
- 三方啥时候能签（12月左右）
- 薪资（网上看到差不多学历背景的，也了解到是根据面评安排薪资的，30*14 到 33*14）
- 能不能实习（愿意，但是要看导师和自己负责项目的情况）
- 为什么选择用友（有和自己所做业务的契合点，也是和一面二面面试官聊了觉得业务上是比较契合的，也是构建数智商业创新平台云服务和软件提供商，业务也是契合当前时代潮流，高潜批次也有比较好的发展，做tob业务也有比较复杂的代码逻辑，以及比较重视沟通协作）
- 所做项目的难点和亮点（主要与师弟、同门、师兄等做导师项目，有团队凝聚力和领导力，有和甲方、领导的协调沟通能力，在很多不同的开发甚至部署环境历练过）

我的反问：
工作节奏：弹性工作制（看月平均），五天工作时间，九点上班下午四点半下班，一天工作八个小时
高潜offer薪资：高潜/精英，看个人情况
户口问题：每年有单列计划，根据北京市政策，根据学校/学科名单，看符合；北京市会给用友公司一些名额，优秀的同学办的比较多（不是90%办不了）
高潜发展问题：进去后入门培训，公司三天（企业文化+历史），BIP专项培训一到三个月（编码规范，代码演练，组队完成代码比赛等），导师落地日常工作。入职后会成立火箭班，1/3是校招生，具体看内部培养

低于京东管培生，高于精通普通培养，高于快手普通培养，工作起来氛围会更好一些

对我的看法：整体上来说是不错的，自驱力韧劲儿啥的，是否愿意主动做一些事情等，技术上会有差别但是不会太大
后续的流程：看招聘部安排，九月底会结束，最晚十月初