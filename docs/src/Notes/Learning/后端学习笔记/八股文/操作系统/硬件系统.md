#### CPU是如何执行程序的？

##### <font color=darkblue>知识点</font>

**冯诺依曼模型**
运算器、控制器、存储器（CPU）、输入设备、输出设备

**CPU内部组件**
寄存器：
`通用寄存器`（存放需要进行计算的数据）、`程序计数器`（存放CPU要执行的下条指令）、`指令寄存器`（存放正在执行的指令）
控制单元
逻辑运算单元

**总线**
`数据总线`（读写内存数据）
`地址总线`（指定CPU将要操作的内存地址）
`控制总线`（发送和接收信号）
CPU首先通过地址总线指定内存地址，通过控制总线控制是读或写命令，通过数据总线传输数据。

**时钟周期**
1GHz的CPU，时钟频率为1G，即1秒执行10亿个时钟周期，每个时钟周期为1纳秒。

**CPU的指令周期**
一条命令执行时，CPU根据程序计数器的内存地址，从内存中把需要执行的指令读到指令寄存器中执行，再根据指令长度自增开始读取下一个指令。

##### <font color=green>样例解析</font>

CPU在执行计算 1+2=3 这个任务的时候：
**1、将程序加载到内存**：将程序代码编译成机器指令存储在内存中，寄存器中的程序计数器指向第一条指令的内存地址。
**2、指令获取**：CPU通过控制单元读取程序计数器中地址，经由地址总线从内存中获取指令，通过数据总线将指令传送到指令寄存器中。
**3、指令解码**：控制单元解析指令并识别操作数和结果存储位置，协调逻辑单元和寄存器确保准备就绪（写入R1，写入R2，计算R3，存储R3）。
**4、数据准备**：将1和2放到寄存器R1和R2中。
**5、执行指令**：逻辑运算单元从寄存器R1和R2读取值1和2，执行加法运算，得到结果。现代CPU使用指令流水线允许获取、解码、执行等阶段并行处理不同指令。
**6、结果存储**：逻辑运算单元将结果3写入寄存器R3，后写入内存。
**7、更新程序计数器**：程序计数器值增加，指向下一条指令的地址，并重复获取-解码-执行流程直到结束。

##### <font color=red>面试题</font>

###### 64 位相比 32 位 CPU 的优势在哪吗？64 位 CPU 的计算性能一定比 32 位 CPU高很多吗？
1、64位的CPU一次性能够计算超过32位的数字，而32位的CPU则要分多步骤计算，因此只有在运算达数字的时候64位CPU优势才能体现出来，否则性能差别不大。
2、通常64位CPU地址总线是48位，而32位CPu地址总线是32位，因此64位CPU能够寻址的内存空间更大。一个32位的CPU的最大寻址能力是4G，即使加了8G的物理内存也无法使用。

###### 你知道软件的 32 位和 64 位之间的区别吗？再来 32 位的操作系统可以运行在64 位的电脑上吗？64 位的操作系统可以运行在 32 位的电脑上吗？如果不行，原因是什么？
32位和64位实际上代表指令是32位还是64位，32位指令集的CPU一次只能处理32位的数据，而64位指令集的CPU一次可以处理64位的数据。
如果32位软件在64位机器执行，则需要一套兼容机制；而64位软件则由于32位寄存器存不下64位指令而无法在32位机器上执行。

#### 磁盘比内存慢几万倍？

**寄存器：**
一个CPU中有几十至几百个寄存器，大多数可以存8（64位）、4（32位）个字节
访问速度极快，半个CPU时钟周期内完成读写

**CPU Cache：**
SRAM（Static Random-Access Memory 静态随机存储器）芯片
L1高速缓存：每个CPU独有，访问速度几乎和寄存器一样快，几十到几百kb，2-4个时钟周期。分为`指令缓存`和`数据缓存`
L2高速缓存：每个CPU独有，几百kb到几mb，10-20个时钟周期。
L3高速缓存：多个CPU核心公用，几mb到几十mb，20-60个时钟周期。

**内存：**
DRAM（Dynamic Random-Access Memory 动态随机存取存储器）芯片
密度更高，功耗更低，容量更大，需要动态刷新才能存储数据。速度200-300个时钟周期。

**SSD/HDD硬盘：**
HHD（Hard Disk Drive）机械硬盘，速度比内存慢十万倍
SSD（Solid-state Disk）固体硬盘，比HHD快10-1000倍

**总结：**
每个存储器只和相邻的一层存储设备打交道，不断向下查询。

##### <font color=red>面试题</font>

###### 机械硬盘，固态硬盘，内存三个存储器，和CPU L1 Cache相比速度差多少？
CPU L1 Cache随机访问延时1纳秒，内存100纳秒，SSD为150微秒，机械硬盘10毫秒
即：1*CPU L1 Cache = 100*内存 = 150000*SSD = 10500000*HDD