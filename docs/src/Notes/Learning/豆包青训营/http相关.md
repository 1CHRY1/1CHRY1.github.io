## HTTP相关

#### <font color=darkblue>HTTP协议</font>

`HTTP`：超文本传输协议(Hypertext Transfer Protocol)，各种类型的消息数据传输。

协议里有什么：
`请求行`：方法名，URL，协议版本
`响应行`：协议版本，状态码，状态码描述

`请求头`：协议相关，业务相关
`响应头`：等

`请求体`：等
`响应体`：等

请求流程：
业务层 -> 服务治理层 -> 路由层 -> 协议编码层 -> 传输层 ->
传输层 -> 协议解码层 -> 路由层 -> 服务治理层 -> 业务层

类型：
`HTTP1`：队头阻塞（基于TCP，等待分片），传输效率低（无用信息多），不支持多路复用（一个连接中请求需要等待前一个请求结束），明文传输不安全

`HTTP2`：多路复用，头部压缩（缓存header），二进制协议（还是TCP）

`QUIC`：基于UDP实现（TCP阻塞解决），快速启动，加密减少握手次数

#### 1、HTTP框架与设计实现

分层设计： 应用层 -> 服务治理层 -> 路由层 -> 协议编码层 -> 传输层

**应用层**：API（可理解，简单，少冗余，兼容性，可测试，可见性）

**中间件层**：核心逻辑于通用逻辑分离（日志记录，性能统计，安全控制，事务处理，异常处理）

**路由层**：前缀匹配树

**协议层**：抽象出合适的接口

**传输层**：网络模型，BIO(BLOCK IO，会阻塞)，NIO(NON BLOCK IO，有监听器)

#### 2、性能修炼之道

**针对网络库的优化**：

`go net`：
流式友好（read由用户调用，数据在tcp的buffer中）；
小包性能高（连接绑定内存，4k左右大小）；

`netpoll`
中大包性能高（底层进行buffer的管理）；
时延低（接口可以发送二维切片）；

**针对协议的优化**：

headers解析：找到Header Line的边界，`\r\n`（SMID方法，加速匹配）；header key规范化 

**热点资源池化**：

复用requestContext，复用减少gc

#### 企业相关

**追求性能** —— 越快越好！
**追求易用，减少无用** —— 方便开发与维护，容易定位问题
**打通内部生态** —— 通用逻辑整合
**文档建设，用户群建设**
